mumudvb v1.2 - README

= Site =
Site principal de mumudvb http://mumudvb.braice.net

= Description =
mumudvb est une modification de dvbstream pour le cr@ns (http://www.crans.org), la quantité de modifications étant importante nous avons décidé de redistribuer le projet (dans l'esprit du logiciel libre).

Désormais mumudvb est un projet indépendant de dvbstream

Mumudvp permet de diffuser plusieurs chaines d'un transpondeur dvb sur différentes adresse de multicast.

= Auteurs =

Auteur principal:
Brice DUBOST (mumudvb@braice.net)

Contributeurs:
Manuel SABBAN (manu@crans.ens-cachan.fr) (implémentation du getopt)
Stephane GLONDU (glondu@crans.ens-cachan.fr) (page de man, nettoyage du Makefile)

Remerciements:
Dave CHAPMAN pour avoir écrit dvbstream.

= Fonctionalités et contenu =

Nouvelles fonctionnalités par rapport à la version 0.6 de dvbstream:

 * Possibilité de diffuser plusieurs chaînes d'un même transpondeur sur des ips différentes
 * Pouvoir afficher la puissance du signal pendant l'utilisation
 * Avoir une liste mise a jour en temps réel des chaînes diffusées (permet de générer les annonces SAP)
 * Avoir un programme qui tourne en tache de fond (en cas d'exécution en tache de fond les logs sont écrit via syslog)
 * Ecriture dans un fichier de son pid
 * Pouvoir utiliser des fichiers de configuration
 * le programme est capable de se tuer tout seul si la carte ne diffuse plus rien au bout d'un temps paramétrable
 * le programme arrête de tenter d'accorder la carte au bout d'un temps paramétrable
 * Permet de diffuser le meme pid sur plusieurs chaines (permet de creer des chaines avec plusieurs langues)
 * Support fonctionnel du DVB-T
 * Diffusion des pids obligatoires systématique
  * Les pids obligatoires sont les suivants :
   * PAT (0): Program Association Table
   * NIT (16) : Network Information Table : Fournit des informations à propos du réseau physique.
   * SDT (17) : Service Description Table : Le pid SDT contient des données décrivant les différents services ex : nom des services, fournisseur du service, etc.
   * EIT (18) : Event Information Table : Le pid EIT contient des données concernant les programmes comme : le nom du programme, l'heure de début, la durée, une description etc ...
   * TDT (20): Time and Date Table : Le pid TDT contient l'heure et la date. Cette information est dans un pid à part car sa mise à jour est fréquente.
 * Le programme s'inscrit lui même au flux (IGMP membership request) pour éviter que certains switchs braodcastent les flux
 * Le programme est capable de réécrire à la volée le pid PAT pour n'annoncer que les flux réelement présents (utile pour les set-top boxes).
  * Cette fonctionalité est expérimentale (03/2006) et ne permet pas de réécrire des Pids PAT plus gros que 188 bytes
 * Support expérimental des chaines cryptées
 * Mumudvb est capable de s'autoconfigurer, voir plus bas

Ce programme n'est pas un patch pour dvbstream à cause de certaines restrictions:
 * obligation d'utiliser un fichier de configuration
 * paramètres en ligne de commande incompatibles
 * les paquets MPEG2 sont envoyés sans modification sur le réseau au lieu d'être envoyés avec les en-têtes RTP (pour une plus grande compatibilité)
 * l'option permettant d'avoir du MPEG2-ps en sortie a été retirée
 * l'interface telnet a été retirée (elle ne nous était pas utile et l'adapter aurait été assez long)

D'autres programmes sont joint dans les sources de mumudvb:
 * relay : permet de relayer un flux (récupérer un flux en multicast et l'unicaster ou l'envoyer vers une autre ip de multicast) il peut être utilisé pour traverser des routeurs ou des firewalls interdisant le multicast.
 * dumpudp : permet de récupérer le flux et de l'envoyer sur la sortie standard (utile pour les programmes n'ayant pas de greffon d'entrée en udp comme mplayer ou pour enregistrer le flux)
 * dumpudp_limited : idem que dumpudp mais récupère un nombre limité de paquets (utilisé pour générer des vignettes (voir les scripts d'exemple joints))
 * recup_sap : mini client sap, récupère les annonces sap sur le réseau pendant 60 secondes et les envoie sur la sortie standard (non triées)
 * scan_modified : une version modifiée de l'utilitaire scan du paquet dvb-apps. Il est capable de générer des fichiers de configuration au formate mumudvb.
 * Des scripts d'exemple d'utilisation de mumudvb sont inclus dans le répertoire scripts, ils sont écrits en python, mais aucune documentation n'est fournie, pour savoir ce qu'ils font, il faut lire le code source ... Ces scripts permettent de configurer automatiquement mumudvb, de générer les annonces sap et de créér des vignettes.


= Installation =

Pour installer mumudvb tapez:

make
make install (en root)

C'est tout!

Si vous voulez utiliser les valeurs par défaut pour la TNT tapez "make FRANCE=1"
au lieu de "make"

Si vous ne spécifiez pas de pays à la compilation, les valeurs par défaut sont auto pour tous les paramètres, excepté pour la bande passante définie à 8MHz.


= Utilisation =

Pour connaître la syntaxe des fichiers de configuration, se référer au fichier README_CONF

Pour une utilisation rapide de mumudvb, voir la section autoconfiguration plus bas.

Syntaxe :
	mumudvb [options] -c fichier_de_configuration
	mumudvb [options] --config fichier_de_configuration
Les différentes options possibles sont : 

-d, --debug
	ne se lance pas en démon et affiche les messages sur la sortie standard et d'erreur

-s, --signal
	Affiche la force du signal pendant que la carte s'accorde et, une fois que la carte est accordé, toutes les 5 secondes

-h, --help
	affiche l'aide

-v
	Rends mumudvb plus "verbeux"

-q
	Rends mumudvb plus silencieux

Signaux : (voir la page de man de kill)
    SIGUSR1 : change l'affichage de la puissance une fois la carte tunée, s'il était absent il devient présent et inversement

= Détails techniques (en vrac) =

 * mumudvb permet de recevoir un signal satellite (DVB-s) ou Terrestre (DVB-t), il ne gère pas les DisEq (si il y a un besoin ce ne devrait pas être trop dur à implémenter)

 * mumudvb diffuse les Pids suivants avec toutes les chaînes (conformément à la norme MPEG2-TS)
   * PAT (0): Program Association Table
   * NIT (16) : Network Information Table : Fournit des informations à propos du réseau physique.
   * SDT (17) : Service Description Table : Le pid SDT contient des données décrivant les différents services ex : nom des services, fournisseur du service,\ etc.
   * EIT (18) : Event Information Table : Le pid EIT contient des données concernant les programmes comme : le nom du programme, l'heure de début, la durée,\ une description etc ...
   * TDT (20): Time and Date Table : Le pid TDT contient l'heure et la date. Cette information est dans un pid à part car sa mise à jour est fréquente.

 * Performances: mumudvb consomme 15% du processeur d'un celeron 2.6GHz avec une carte Hauppauge et un noyau Linux 2.6.9 pour un transpondeur plein (mumudvb a été développé à l'origine dans ce but, après des tests avec VLC qui offrait de piteuses performances, une instabilité chronique et avec des fonctionnalités manquantes pour notre utilisation)

 * A éviter : les chipset via non récents ou nforce, ces chipset sont des chipsets grand public, incapables de gérer correctement une grande quantité de données sur le bus PCI.

 * mumudvb est capable de diffuser de la TNT (télévision numérique terrestre). N'oubliez pas de spécifier les paramètres de réception si vous n'avez pas spécifié la localisation FRANCE ou si vous utilisez le transpondeur R1, dans le doute vérifiez les. (vous pouvez tous les mettre en auto sauf le BandWidth)

 * mumudvb n'est à priori pas capable de diffuser du dvb-c (non essayé)

 * Lors de l'exécution le programme écrit la liste des chaînes diffusées dans le fichier /var/run/mumudvb/chaines_diffusees_carte%d le %d est remplacé par le numéro de carte, le chemin n'est pas paramétrable mais cela est facile à implémenter, envoyez moi un mail si vous en avez besoin. Ce fichier contient la liste des chaînes diffusées (actualisée toute les 5 secondes) de la forme suivante (pour chaque ligne) : "nom:ip:port"

 * mumudvb supporte au maximum 6 cartes (à l'heure ou j'écris (04/2005), les possibilités sont d'utiliser un noyau 2.4.* avec devfs :-( ou d'utiliser un noyau > 2.6.11 ( ou 2.6.10 avec un backport du patch )  avec udev compilé statiquement avec klibc en attendant la mise a jour de la glibc ), cette limite peut être augmentée facilement si quelqu'un a une carte avec plus de 6 slots PCI (on est intéressé dans ce cas)

= Problèmes connus =

== Vlc incapable de lire le flux vidéo mais pas xine ou mplayer ==

 * Pour Vlc, il faut indiquer le pid PMT en plus des pids audio et vidéo (sinon, il est aussi incapable de voir ce qui est présent dans le flux). Ceci est un problème courant, en effet scan ne fournit pas le pid PMT mais son numéro. pour résoudre ce problème, on peut utiliser {{{vlc -v}}} qui va vous sortir une ligne du genre : {{{[00000269] ts demuxer debug:   * number=1025 pid=110}}} vous aurez la correspondance entre le nombre donné par scan et le pid réel. Vous pouvez aussi utiliser dvbsnoop. Une autre solution est d'utiliser l'utilitaire scan modifié (joint a mumudvb) qui va permettre de générer la configuration incluant le PID PMT.

== Le programme quitte inopinément en mode deamon ==

 * Lors de l'exécution le programme écrit la liste des chaînes diffusées dans le fichier /var/run/mumudvb/chaines_diffusees_carte%d le %d est remplacé par le numéro de carte, si le chemin n'existe pas le probramme s'arrête. Pour vérifier, regarder dans /var/log/syslog ou /var/log/message devrait aider.

== Crash du système en utilisant mumudvb ==

 * les chipset via non récents ou nforce, ces chipset sont des chipsets grand public, incapable de gérer correctement une grande quantité de données sur le bus PCI, ils peuvent faire planter la machine complètement.

== Problème d'accord avec la TNT ==

 * Il faut vérifier vos paramètres d'accord, en sachant que le paramètre bandwidth ne peux pas être mis en auto.

= Autoconfiguration =

Depuis 07/2008, mumudvb est capable de s'autoconfigurer.

Mumudvb est capable de faire deux types d'autoconfiguration : 

== Autoconfiguration Complète ==

C'est la manière la plus simple d'utiliser mumudvb

Utilisez ce mode lorsque vous voulez diffuser un transpondeur complet.

Dans ce mode, mumudvb va trouver pour vous, les différentes chaînes, leurs noms et leurs PIDs (PMT, Audio, Vidéo, Sous-titres, Télétexte et AC3).

Pour utiliser ce mode vous devez : 
 * Définir les parametres pour l'accord de la carte (fréquence polarisation etc) dans le fichier de configuration
 * Ajouter "autoconfiguration=2" dans le fichier de configuration
 * Vous n'avez a définir aucune chanie
 * Pour avoir les messages dans la console, pensez à utiliser le paramètre "-d" : 
   ex : mumudvb -d -c your_config_file

Exemple de fichier de configuration : 

-----
freq=11296
pol=h
srate=27500
common_port=1234
autoconfiguration=2
-----

Les chaînes seront diffusées sur les ip de multicast 239.100.c.n où c est le numéro de carte (0 par défaut) et n le numéro de chaîne.

== Autoconfiguration "simple" ==

Utilisez ce mode lorsque vous voulez controller le nom des chaînes, leurs ip et quelles chaines vous voulez diffuser

Dans ce cas, vous avez a préciser pour chaque chaîne : 
 * L'adresse ip
 * Le port (optionnel si vous utilisez common_port)
 * Le nom
 * Le pid PMT 

Et vous avez a ajouter "autoconfiguration=1" au début de votre fichier de configuration.

Mumudvb trouvera les autres PIDs de chaque chaîne (Audio, Vidéo, Sous-titres, Télétexte et AC3) avant de les diffuser.

Note : si vous précisez plus d'un PID pour une chaine, mumudvb désactivera l'autoconfiguration pour cette chaîne.
